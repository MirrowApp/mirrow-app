---
const code = String.raw`svg {
  // Internal coordinate space: viewBox x y w h
  box: (0, 0, 200, 200)

  // Rendered size on the page
  size: (200px, 200px)        // accepts px, %, or auto

  // How to map box to size
  fit: contain                 // contain | cover | stretch
  align: center                // start | center | end for x and y

  circle {
    id: "pulse"
    at: (100,100)
    r: 40
    fill: "hotpink"

    animate: {
      prop: "r"
      from: 40
      to: 60
      dur: 2s
      repeat: infinite
    }
  }

  hover, active {
    #pulse {
      cy: 150
      r: 60
    }
  }
}

`;

const highlightJs = (src: string) => {
  let html = src;

  const placeholders: string[] = [];
  const protectRe =
    /\/\*[\s\S]*?\*\/|\/\/.*?$|`[^`]*`|\"([^\"\\]|\\.)*\"|'([^'\\]|\\.)*'/gm;
  html = html.replace(protectRe, (m) => {
    const cls =
      m.startsWith("/*") || m.startsWith("//") ? "tok-comment" : "tok-string";
    const idx = placeholders.push(`<span class=\"${cls}\">${m}</span>`) - 1;
    return `__PH_${idx}__`;
  });

  html = html.replace(
    /\b\d+(?:\.\d+)?\b/g,
    (m) => `<span class=\"tok-number\">${m}</span>`
  );
  html = html.replace(
    /\b(?:const|let|var|class|return|async|await|try|catch|throw|new|if|else|for|while|function)\b(?!\s*=)/g,
    (m) => `<span class=\"tok-kw\">${m}</span>`
  );
  html = html.replace(
    /\b(?:null|undefined|true|false)\b/g,
    (m) => `<span class=\"tok-builtin\">${m}</span>`
  );

  html = html.replace(/__PH_(\d+)__/g, (_m, i) => placeholders[Number(i)]);
  return html;
};

const highlighted = highlightJs(code);
---

<pre
  class="overflow-x-scroll overflow-y-hidden relative rounded-3xl group border hover:border-[#686868] border-[#383838] transition-all z-0 duration-500 text-sm text-slate-100 shadow-sm max-w-3xl backdrop-blur-xs p-4">
  <div class="language-js" set:html={highlighted} />
  <div class="absolute top-3/4 left-3/4 -translate-1/2 z-10 hidden sm:flex border transition-all bg-[#101010] duration-500 group-hover:border-[#686868] border-[#383838] rounded-2xl p-8 text-white">
    <svg viewBox="0 0 200 200" width="100" height="100" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">

    <circle id="pulse" cx="100" cy="100" r="40" fill="hotpink">
        <animate attributeName="r" from="40" to="60" dur="2s" repeatCount="indefinite" />
    </circle>

    </svg>

  </div>
</pre>

<style>
  svg #pulse {
    transition:
      r 400ms,
      cy 600ms;
  }
  svg:hover #pulse,
  svg:active #pulse {
    cy: 150px;
    r: 60px;
  }

  :global(pre div.language-js) {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
      "Liberation Mono", "Courier New", monospace;
    line-height: 1.6;
    display: block;
    white-space: pre-wrap;
  }
  :global(.tok-kw) {
    color: #34d399; /* emerald-400 */
  }
  :global(.tok-string) {
    color: #7dd3fc; /* sky-300 */
  }
  :global(.tok-number) {
    color: #c4b5fd; /* violet-300 */
  }
  :global(.tok-comment) {
    color: #94a3b8; /* slate-400 */
  }
  :global(.tok-builtin) {
    color: #fbbf24; /* amber-400 */
  }
</style>
